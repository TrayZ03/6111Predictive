"0","lr_calibration_data <- data.frame(bin_midpoint=seq(0.05,0.95,0.1),"
"0","                                  observed_event_percentage=0,"
"0","                                  classifier=""LR"")"
"0","knn_calibration_data <- data.frame(bin_midpoint=seq(0.05,0.95,0.1),"
"0","                                   observed_event_percentage=0,"
"0","                                   classifier=""KNN"")"
"0",""
"0","for (i in seq(0.05,0.95,0.1)) {"
"0","  "
"0","  # For linear regression"
"0","  lr_in_interval <- lr_test_results[lr_test_results$.pred_Attrited.Customer >= (i-0.05) & lr_test_results$.pred_Attrited.Customer <= (i+0.05), ]"
"0","  lr_oep <- round(nrow(lr_in_interval[lr_in_interval$Attrition_Flag==""Attrited Customer"", ])/nrow(lr_in_interval), 2)"
"0","  lr_calibration_data[lr_calibration_data$bin_midpoint==i, ""observed_event_percentage""] <- lr_oep"
"0","  "
"0","  # For k-nearest neighbors"
"0","  knn_in_interval <- knn_test_results[knn_test_results$.pred_Attrited.Customer >= (i-0.05) & knn_test_results$.pred_Attrited.Customer <= (i+0.05), ]"
"0","  knn_oep <- round(nrow(knn_in_interval[knn_in_interval$Attrition_Flag==""Attrited Customer"", ])/nrow(knn_in_interval), 2)"
"0","  knn_calibration_data[knn_calibration_data$bin_midpoint==i, ""observed_event_percentage""] <- knn_oep"
"0","}"
"0",""
"0","ggplot() +"
"0","  geom_line(data = lr_calibration_data, "
"0","            aes(x = bin_midpoint, y = observed_event_percentage, color= classifier)"
"0","            ) +"
"0","  geom_line(data = knn_calibration_data, "
"0","            aes(x = bin_midpoint, y = observed_event_percentage, color= classifier)"
"0","            ) +"
"0","  geom_point(data = lr_calibration_data, "
"0","            aes(x = bin_midpoint, y = observed_event_percentage, color= classifier), "
"0","            size = 2) +"
"0","  geom_point(data = knn_calibration_data, "
"0","            aes(x = bin_midpoint, y = observed_event_percentage, color= classifier), "
"0","            size = 2) +"
"0","  geom_text(data = lr_calibration_data, "
"0","            aes(x = bin_midpoint, y = observed_event_percentage, label = observed_event_percentage),"
"0","            hjust = 0.75, vjust = -0.5, color = ""blue"", size=3) +  "
"0","  geom_text(data = knn_calibration_data, "
"0","            aes(x = bin_midpoint, y = observed_event_percentage, label = observed_event_percentage),"
"0","            hjust = 0.75, vjust = -0.5, color = ""darkgreen"", size=3) + "
"0","  scale_color_manual(values = c(""LR"" = ""blue"", ""KNN"" = ""darkgreen"")) +"
"0","  geom_abline(intercept = 0, slope = 1, lty = 2) +"
"0","  scale_x_continuous(breaks = seq(0, 1, 0.2), labels = seq(0, 1, 0.2)) +"
"0","  scale_y_continuous(breaks = seq(0, 1, 0.2), labels = seq(0, 1, 0.2)) +"
"0","  labs("
"0","    title = ""Calibration Curves"","
"0","    subtitle = """","
"0","    caption = """","
"0","    x = ""Mean Predicted Probability (Positive Class: 'Attrited Customer')"","
"0","    y = ""Fraction of Positives"""
"0","  )"
